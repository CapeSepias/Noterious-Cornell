<%- include('header'); -%>

    <!-- Search section -->
      <form action="/notes">
        <div class="form-row mb-2">
          <div class="col-5">
            <input type="text" class="form-control" name="search-title" aria-describedby="fullTextSearch" placeholder="Full text search"/>
          </div>
          <div class="col">
            <button type="submit" class="btn btn-outline-dark">Search</button>
            <button type="button" class="btn btn-outline-dark button-clear">Clear</button>
          </div>
        </div>
      </form>
    <!-- Search result section aka notes list -->
    <table class="table table-borderless table-hover table-striped table-sm">
      <thead class="thead-dark">
        <tr>
          <th scope="col" class="w-25 align-middle">Title</th>
          <th scope="col" class="w-25 align-middle">Keywords</th>
          <th scope="col" class="w-50 align-middle">Note</th>
          <th scope="col" class="align-middle">
            <form action="/addnote" method="get"><button type="submit" class="btn btn-success btn-block">Add</button></form>
          </th>
        </tr>
      </thead>
      <% const keywordsToShow = 3 %>
      <% const noteParagraphsToShow = 2 %>

      <% if (notes && notes.length > 0){ %>
        <tbody>
          <% notes.forEach(function(note){ %>
          <tr noteid=<%= note._id %>>
            <td class="text-break font-weight-bolder"> <%= note.title %></td>
            <td class="text-break ">

              <% var keywords = note.keywords.split(/\r\n/); %>
              <% for(let i = 1; i <= keywords.length && i <= keywordsToShow + 1; i++) { %>
                <% if(i === keywordsToShow + 1){ %>
                  <p class="font-italic">Click to read more...</p>
                  <% break; %>
                <% } %>
               <p class="mb-1 text-uppercase text-monospace"><%= keywords[i - 1] %></p>
              <% } %>
            </td>

            <td class="text-break text-justify">
              <% var notes = note.notes.split(/\r\n/); %>
              <% console.clear() %>
              <% for(let i = 1; i <= notes.length && i <= noteParagraphsToShow + 1; i++) { %>
                <% console.log("Iteracja: " + i) %>
                <% if(i === noteParagraphsToShow + 1){ %>
                  <p class="font-italic">Click to read more...</p>
                  <% break; %>
                <% } %>
               <p class="mb-1"><%= notes[i - 1] %></p>
              <% } %>
            </td>
            <td class="buttons">
              <button type="button" class="btn btn-warning btn-block edit mb-1 invisible">Edit</button></form>
              <form action="/deleteNote/<%= note._id %>" method="post"><button type="submit" class="btn btn-danger btn-block invisible">Delete</button></form>
            </td>
          </tr>
          <% }); %>
        </tbody>
      <% } %>
      </table>

<%- include('footer'); -%>
